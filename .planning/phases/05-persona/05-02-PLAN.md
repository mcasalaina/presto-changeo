---
phase: 05-persona
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/components/PersonaCard.tsx
  - frontend/src/App.tsx
  - frontend/src/types/mode.ts
autonomous: false

must_haves:
  truths:
    - "User sees persona name and key stat in dashboard header"
    - "Persona card updates when mode switches"
    - "Persona card styling matches current mode theme"
  artifacts:
    - path: "frontend/src/components/PersonaCard.tsx"
      provides: "Compact persona display component"
      min_lines: 30
    - path: "frontend/src/types/mode.ts"
      provides: "Persona TypeScript interfaces"
      contains: "interface.*Persona"
  key_links:
    - from: "App.tsx mode_switch handler"
      to: "persona state"
      via: "setPersona from message payload"
      pattern: "setPersona.*payload.*persona"
    - from: "App.tsx"
      to: "PersonaCard"
      via: "component render with persona prop"
      pattern: "<PersonaCard.*persona"
---

<objective>
Frontend persona display with a compact header card showing customer name and key stat.

Purpose: Give users visual feedback about which "customer" they're demoing with, reinforcing the simulation's believability.

Output: PersonaCard component integrated into dashboard, updating on mode switch.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-persona/05-CONTEXT.md
@.planning/phases/05-persona/05-01-SUMMARY.md

# Source files:
@frontend/src/App.tsx
@frontend/src/types/mode.ts
@frontend/src/context/ModeContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add persona types and create PersonaCard component</name>
  <files>frontend/src/types/mode.ts, frontend/src/components/PersonaCard.tsx</files>
  <action>
1. Update frontend/src/types/mode.ts with persona interfaces:

   // Persona types (union type for all industries)
   export interface BasePersona {
     name: string;
     member_since?: string;
   }

   export interface BankingPersona extends BasePersona {
     checking_balance: number;
     savings_balance: number;
     credit_score: number;
     account_number_last4: string;
   }

   export interface InsurancePersona extends BasePersona {
     total_coverage: number;
     monthly_premium: number;
     active_policies: Array<{ type: string; coverage: number }>;
     risk_score: string;
   }

   export interface HealthcarePersona extends BasePersona {
     member_id: string;
     primary_care_provider: string;
     deductible: number;
     deductible_met: number;
     active_prescriptions: Array<{ medication: string }>;
   }

   export type Persona = BankingPersona | InsurancePersona | HealthcarePersona | null;

2. Create frontend/src/components/PersonaCard.tsx:

   - Props: persona (Persona type), modeId (string)
   - Display logic based on mode:
     - Banking: Show name + checking balance as key stat
     - Insurance: Show name + total coverage as key stat
     - Healthcare: Show name + member ID as key stat
   - Compact styling: Small card, subtle presence
   - Use CSS custom properties for theme colors (var(--theme-primary), etc.)
   - Style: rounded corners, subtle border, small padding
   - Show "ðŸ‘¤" icon before name
   - Format currency values with toLocaleString()
   - Return null if no persona
  </action>
  <verify>
npm run build 2>&1 | grep -E "(error|Error)" || echo "Build passed"
  </verify>
  <done>
- Persona TypeScript interfaces defined
- PersonaCard component created and compiles
- Component renders different key stats per mode
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate PersonaCard into dashboard</name>
  <files>frontend/src/App.tsx</files>
  <action>
Modify frontend/src/App.tsx to:

1. Import PersonaCard and Persona type:
   import { PersonaCard } from './components/PersonaCard';
   import type { Persona } from './types/mode';

2. Add persona state:
   const [persona, setPersona] = useState<Persona>(null);

3. Update mode_switch message handler to extract persona:
   In the 'mode_switch' case, after setMode(newMode):

   if (payload.persona) {
     setPersona(payload.persona as Persona);
   }

4. Clear persona when messages are cleared (if needed):
   Optional: persona persists through conversation, only changes on mode switch

5. Render PersonaCard in the dashboard section:
   Position it at the top of the center panel, above the chart area.

   Inside the dashboard content area (probably above {chartData && ...}):
   {persona && <PersonaCard persona={persona} modeId={mode?.id || 'banking'} />}

6. Add some spacing below the PersonaCard if rendered (margin-bottom in component or wrapper div)
  </action>
  <verify>
npm run build 2>&1 | grep -E "(error|Error)" || echo "Build passed"
  </verify>
  <done>
- Persona state managed in App
- mode_switch handler extracts persona
- PersonaCard renders in dashboard
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete persona system: backend generation + frontend display</what-built>
  <how-to-verify>
    1. Start backend: cd backend && python main.py
    2. Start frontend: cd frontend && npm run dev
    3. Visit: http://localhost:5173
    4. Type: "Presto-Change-O, you're a bank"
    5. Verify: PersonaCard appears showing a customer name and checking balance
    6. Type: "What's my checking balance?"
    7. Verify: AI responds with the same balance shown in the PersonaCard
    8. Type: "Presto-Change-O, you're an insurance company"
    9. Verify: PersonaCard updates to show insurance customer with total coverage
    10. Type: "Presto-Change-O, you're a healthcare provider"
    11. Verify: PersonaCard updates to show patient with member ID
    12. Refresh page, repeat step 4
    13. Verify: Same persona name appears (seeding is consistent)
  </how-to-verify>
  <resume-signal>Type "approved" if persona displays correctly and AI references persona data, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds in frontend
- [ ] PersonaCard renders for all three modes
- [ ] AI references persona data in responses
- [ ] Same seed produces same persona (refresh test)
</verification>

<success_criteria>

- All tasks completed
- PersonaCard visible in dashboard
- Persona updates on mode switch
- AI references persona data naturally
- User approved visual appearance
</success_criteria>

<output>
After completion, create `.planning/phases/05-persona/05-02-SUMMARY.md`
</output>
