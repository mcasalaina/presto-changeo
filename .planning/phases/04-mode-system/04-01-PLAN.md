---
phase: 04-mode-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/mode.ts
  - backend/modes.py
  - frontend/src/App.css
autonomous: true

must_haves:
  truths:
    - "Mode type definitions exist with theme colors, tabs, and system prompt"
    - "CSS custom properties system enables dynamic theming"
  artifacts:
    - path: "frontend/src/types/mode.ts"
      provides: "TypeScript interfaces for Mode, ModeTheme, ModeTab"
      min_lines: 25
    - path: "backend/modes.py"
      provides: "Pydantic models for mode configuration"
      min_lines: 20
    - path: "frontend/src/App.css"
      provides: "CSS custom properties for theming"
      contains: "--theme-primary"
  key_links:
    - from: "frontend/src/types/mode.ts"
      to: "frontend components"
      via: "import type { Mode }"
      pattern: "interface Mode"
---

<objective>
Establish mode infrastructure with shared type definitions and CSS theming system.

Purpose: Create the foundational types and theming system that all mode-related features build upon.
Output: TypeScript interfaces, Python models, and CSS custom properties for dynamic theming.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns from Phase 3
@.planning/phases/03-dashboard/03-02-SUMMARY.md

# Current files to understand structure
@frontend/src/App.tsx
@frontend/src/App.css
@backend/chat.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mode type definitions</name>
  <files>frontend/src/types/mode.ts, backend/modes.py</files>
  <action>
Create TypeScript interfaces in `frontend/src/types/mode.ts`:

```typescript
export interface ModeTheme {
  primary: string      // Main brand color (e.g., #1E88E5 for banking)
  secondary: string    // Accent color
  background: string   // Dashboard background
  surface: string      // Card/panel background
  text: string         // Primary text color
  textMuted: string    // Secondary text color
}

export interface ModeTab {
  id: string
  label: string
  icon: string         // Emoji icon
}

export interface Mode {
  id: string           // 'banking' | 'insurance' | 'healthcare'
  name: string         // Display name: "Banking", "Insurance", etc.
  theme: ModeTheme
  tabs: ModeTab[]
  systemPrompt: string // AI personality prompt for this mode
  defaultMetrics: Array<{ label: string; value: string | number; unit?: string }>
}
```

Create corresponding Pydantic models in `backend/modes.py`:

```python
from pydantic import BaseModel

class ModeTheme(BaseModel):
    primary: str
    secondary: str
    background: str
    surface: str
    text: str
    text_muted: str

class ModeTab(BaseModel):
    id: str
    label: str
    icon: str

class ModeMetric(BaseModel):
    label: str
    value: str | int | float
    unit: str | None = None

class Mode(BaseModel):
    id: str
    name: str
    theme: ModeTheme
    tabs: list[ModeTab]
    system_prompt: str
    default_metrics: list[ModeMetric]
```
  </action>
  <verify>
    - `npx tsc --noEmit` in frontend directory succeeds
    - `python -c "from modes import Mode"` in backend directory succeeds
  </verify>
  <done>TypeScript and Python mode types defined and importable</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS custom properties theming system</name>
  <files>frontend/src/App.css</files>
  <action>
Add CSS custom properties at the top of App.css (after the reset rules, before .app):

```css
/* ==================== THEME VARIABLES ==================== */

:root {
  /* Default theme (Banking) */
  --theme-primary: #1E88E5;
  --theme-secondary: #43A047;
  --theme-background: #f8fafc;
  --theme-surface: #ffffff;
  --theme-text: #0f172a;
  --theme-text-muted: #64748b;
}
```

Update dashboard and component styles to use CSS variables instead of hardcoded colors:

1. Replace `.dashboard-panel` background-color with `var(--theme-background)`
2. Replace `.metric-card` background with `var(--theme-surface)` and border with `var(--theme-text-muted)` at 20% opacity
3. Replace `.metric-value` color with `var(--theme-text)`
4. Replace `.metric-label` color with `var(--theme-text-muted)`
5. Replace `.chart-bar` gradient to use `var(--theme-primary)` and its darker shade
6. Replace `.chart-value` color with `var(--theme-primary)`
7. Replace `.tab-button.active` background and text with `var(--theme-primary)` variants

Keep chat panel colors unchanged (dark blue sidebar is consistent across modes).
  </action>
  <verify>
    - `npm run build` in frontend directory succeeds
    - App.css contains `--theme-primary` and other CSS variables
    - Dashboard styles reference `var(--theme-*)` properties
  </verify>
  <done>CSS custom properties defined and used throughout dashboard styles</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds in frontend directory
- [ ] `python -c "from modes import Mode, ModeTheme"` succeeds in backend directory
- [ ] CSS variables defined in :root
- [ ] Dashboard styles use var(--theme-*) properties
- [ ] No TypeScript or Python errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Type definitions match between frontend and backend
- CSS theming system ready for dynamic switching
  </success_criteria>

<output>
After completion, create `.planning/phases/04-mode-system/04-01-SUMMARY.md`
</output>
