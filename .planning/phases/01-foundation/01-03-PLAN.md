---
phase: 01-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified: [frontend/src/App.tsx, frontend/src/hooks/useWebSocket.ts]
autonomous: false

must_haves:
  truths:
    - "Browser console shows WebSocket connection established"
    - "Messages sent from frontend echo back from backend"
    - "Azure authentication popup appears when triggered"
  artifacts:
    - path: "frontend/src/hooks/useWebSocket.ts"
      provides: "React hook for WebSocket state management"
      exports: ["useWebSocket"]
    - path: "frontend/src/App.tsx"
      provides: "Root component with connection status display"
      contains: "useWebSocket"
  key_links:
    - from: "frontend/src/App.tsx"
      to: "backend/main.py /ws"
      via: "WebSocket connection"
      pattern: "ws://localhost:8000/ws"
    - from: "frontend/src/hooks/useWebSocket.ts"
      to: "frontend/src/lib/websocket.ts"
      via: "import connectWebSocket"
      pattern: "import.*websocket"
---

<objective>
Wire frontend WebSocket to backend and verify end-to-end foundation works.

Purpose: Confirm the foundation infrastructure is properly connected before building features on top.
Output: Working WebSocket connection between frontend and backend with visual confirmation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useWebSocket React hook</name>
  <files>frontend/src/hooks/useWebSocket.ts</files>
  <action>
    Create a React hook for WebSocket state management:
    1. Create frontend/src/hooks/ directory
    2. Create useWebSocket.ts with:
       - useWebSocket(url?: string) hook that:
         - Manages WebSocket instance via useRef
         - Tracks connection state: 'connecting' | 'connected' | 'disconnected' | 'error'
         - Provides send(message: object) function
         - Provides lastMessage state for received messages
         - Auto-connects on mount, disconnects on unmount
         - Uses the websocket.ts utilities from lib/
       - Return type: { status, send, lastMessage, connect, disconnect }

    Use useState for status and lastMessage, useEffect for connection lifecycle.
    Default URL: ws://localhost:8000/ws
  </action>
  <verify>
    cd frontend && npx tsc --noEmit
    # Should pass type checking
  </verify>
  <done>
    - frontend/src/hooks/useWebSocket.ts exists
    - Hook exports useWebSocket
    - TypeScript compiles
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire App.tsx to display connection status</name>
  <files>frontend/src/App.tsx</files>
  <action>
    Update App.tsx to use WebSocket hook and show connection status:
    1. Import useWebSocket hook
    2. Call hook in App component
    3. Display connection status with color indicator:
       - Green dot + "Connected" when connected
       - Yellow dot + "Connecting..." when connecting
       - Red dot + "Disconnected" when disconnected/error
    4. Add a test input field and button to send messages
    5. Display last received message (for echo testing)

    Keep the dark theme (#0a1628 background). Minimal styling - just functional.
  </action>
  <verify>
    cd frontend && npm run build
    # Should build without errors
  </verify>
  <done>
    - App.tsx imports and uses useWebSocket
    - Connection status displays visually
    - Test message UI present
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete foundation with WebSocket connection between React frontend and FastAPI backend</what-built>
  <how-to-verify>
    1. Open TWO terminals

    Terminal 1 - Start backend:
    ```
    cd backend
    pip install -r requirements.txt  (if not done)
    python -m uvicorn main:app --reload
    ```
    Should see: "Uvicorn running on http://127.0.0.1:8000"

    Terminal 2 - Start frontend:
    ```
    cd frontend
    npm run dev
    ```
    Should see: "Local: http://localhost:5173/"

    2. Open browser to http://localhost:5173/
    3. Verify:
       - Page loads with "Presto-Change-O" heading
       - Connection status shows green "Connected"
       - Type a test message and click Send
       - Message echoes back and displays

    4. Test reconnection:
       - Stop backend (Ctrl+C in Terminal 1)
       - Status should change to red "Disconnected"
       - Restart backend
       - Status should return to green "Connected"
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Frontend and backend both start without errors
- [ ] WebSocket connection establishes automatically
- [ ] Echo messages work round-trip
- [ ] Connection status reflects actual state
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>

- useWebSocket hook created and working
- App.tsx displays live connection status
- Messages echo from frontend → backend → frontend
- Human verified the complete foundation works
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
